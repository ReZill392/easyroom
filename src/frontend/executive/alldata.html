<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Dashboard</title>
  <link rel="stylesheet" href="alldatastyle.css">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons/font/bootstrap-icons.css" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <!-- Bootstrap CSS -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet">

  <!-- Bootstrap JS (‡∏û‡∏£‡πâ‡∏≠‡∏° Popper.js) -->
  <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.10.2/dist/umd/popper.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.min.js"></script>

  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 0;
      padding: 0;

    }

    .content-area {

      margin-left: 290px;
      /* Matches the sidebar's width */
      padding: 20px;
      background-color: #f8f9fa;
      min-height: 100vh;
      /* Ensure the content area stretches to full height */
    }

    /* Responsive: ‡∏à‡∏≠‡πÄ‡∏•‡πá‡∏Å */
    @media (max-width: 576px) {
      .sidebar {
        position: relative;
        width: 100%;
        box-shadow: none;
      }

      .content-area {
        margin-left: 0;
      }
    }

    .sidebar .btn:last-child {
      margin-top: auto;
      /* ‡∏î‡∏±‡∏ô‡∏õ‡∏∏‡πà‡∏°‡πÉ‡∏´‡πâ‡∏≠‡∏¢‡∏π‡πà‡∏•‡πà‡∏≤‡∏á‡∏™‡∏∏‡∏î */
    }

    .canvas {
      width: 100%;
      /* Expand canvas width */
      max-width: 600px;
      /* Optional: Set a max width */
      height: 500px;
      /* Increase height for better vertical display */
    }
  </style>
</head>

<body>
  <div id="sidebar-container"></div>
  <div class="content-area">
    <!-- ‡πÄ‡∏ô‡∏∑‡πâ‡∏≠‡∏´‡∏≤‡πÉ‡∏ô‡∏™‡πà‡∏ß‡∏ô‡∏ô‡∏µ‡πâ‡∏à‡∏∞‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å Sidebar ‡∏ó‡∏±‡∏ö -->
    <div class="container" onclick="window.location.href='detailroom.html';">
      <section class="charts">
        <div class="chart-header">
          <h3 class="most-room" style="font-weight: bold;">‡∏´‡πâ‡∏≠‡∏á‡∏ó‡∏µ‡πà‡πÉ‡∏ä‡πâ‡πÄ‡∏¢‡∏≠‡∏∞‡∏ó‡∏µ‡πà‡∏™‡∏∏‡∏î</h3>
        </div>
        <div style="display: flex; justify-content: space-around; align-items: center; flex-wrap: wrap;">
          <!-- Bar Chart -->
          <div style="width: 600px; height: 300px; margin-top: 40px;">
            <canvas id="barChart"></canvas>
          </div>
        </div>
      </section>
    </div>


    <div class="container-two">
      <section class="graph">
        <div class="graph-container">
          <div>
            <h3 class="graph-header">‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏Ñ‡∏ô‡∏à‡∏≠‡∏á
              <div class="dropdown d-inline">
                <i class="bi bi-caret-down-fill" type="button" data-bs-toggle="dropdown" aria-expanded="false"
                  style="color: #929292; font-size: 10px;">
                </i>
                <ul class="dropdown-menu">
                  <li><a class="dropdown-item" href="#">Week</a></li>
                  <li><a class="dropdown-item" href="#">Mouth</a></li>
                  <li><a class="dropdown-item" href="#">Year</a></li>
                </ul>
              </div>
            </h3>
          </div>
          <div>
            <canvas id="barChart2" style="height: 630px; width: 100%; "></canvas>

          </div>
          <br><button onclick="window.location.href='grap.html'"
            style="border-radius: 5px; margin-top: 2rem;">Details</button>
        </div>
      </section>

      <section class="equipment">
        <div class="equip-container">
          <div>
            <h3 class="graph-header" style="text-align: center;">‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå
              <div class="dropdown d-inline">
                <i class="bi bi-caret-down-fill" type="button" data-bs-toggle="dropdown" aria-expanded="false"
                  style="color: #929292; font-size: 10px;">
                </i>
                <ul class="dropdown-menu">
                  <li><a class="dropdown-item" href="#">‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå‡πÅ‡∏à‡πâ‡∏á‡∏ã‡πà‡∏≠‡∏°</a></li>
                  <li><a class="dropdown-item" href="#">‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå‡∏¢‡∏∑‡∏°</a></li>
                </ul>
              </div>
            </h3>
          </div>
          <div onclick="window.location.href='broken_equipment.html';" style="cursor: pointer;">
            <div style="width: auto; height: auto;">
              <canvas id="doughnutChart1"></canvas>
            </div>
          </div>
          <div onclick="window.location.href='borrow_equipment.html';" style="cursor: pointer;">
            <div style="width: auto; height: auto;">
              <canvas id="doughnutChart2"></canvas>
            </div>
          </div>
          <button onclick="window.location.href='eqiup.html'" style="border-radius: 5px;">Details</button>
      </section>
    </div>

    <div class="container-three">
      <section class="moststuden-container">
        <div>
          <h3 class="moststuden-header">‡∏ô‡∏¥‡∏™‡∏¥‡∏ï‡∏ó‡∏µ‡πà‡∏à‡∏≠‡∏á‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡∏´‡πâ‡∏≠‡∏á‡∏ö‡πà‡∏≠‡∏¢‡∏ó‡∏µ‡πà‡∏™‡∏∏‡∏î</h3>
        </div>
        <div>
          <section id="userList">
          </section>
          <button onclick="window.location.href='student.html';" style="border-radius: 5px;">Details</button>
        </div>
      </section>

      <section class="moststuden-container">
        <div>
          <h3 class="moststuden-header">‡∏ô‡∏¥‡∏™‡∏¥‡∏ï‡∏ó‡∏µ‡πà‡πÅ‡∏à‡πâ‡∏á‡∏ã‡πà‡∏≠‡∏°‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå‡∏ö‡πà‡∏≠‡∏¢‡∏ó‡∏µ‡πà‡∏™‡∏∏‡∏î</h3>
        </div>
        <div>
          <section>
            <div class="split-container">
              <p3>‡∏ô‡∏≤‡∏¢ ‡∏Ñ‡∏≥‡∏°‡∏µ ‡∏™‡∏≤‡πÄ‡∏Å</p3>
              <p4>3 ‡∏Ñ‡∏£‡∏±‡πâ‡∏á</p4>
            </div>
            <br>
            <div class="split-container">
              <p3>‡∏ô‡∏≤‡∏á‡∏™‡∏≤‡∏ß ‡∏≠‡∏∏‡πâ‡∏á‡∏≠‡∏¥‡πâ‡∏á ‡∏≠‡∏á‡∏Ñ‡πå‡∏Å‡∏£</p3>
              <p4>2 ‡∏Ñ‡∏£‡∏±‡πâ‡∏á</p4>
            </div>
            <br>
            <div class="split-container">
              <p3>‡∏ô‡∏≤‡∏¢ ‡∏ò‡∏µ‡∏£‡∏û‡∏á‡∏©‡πå ‡∏û‡∏≤‡∏™‡∏∏‡∏Ç</p3>
              <p4>1 ‡∏Ñ‡∏£‡∏±‡πâ‡∏á</p4>
            </div>
          </section>
          <button onclick="window.location.href='student.html';" style="border-radius: 5px;">Details</button>
        </div>
      </section>
    </section>
  </div>
  <script>
    // fetch sidebar
    fetch("sidebar.html")
      .then((resp) => resp.text())
      .then((html) => {
        // ‡πÅ‡∏ó‡∏£‡∏Å Sidebar ‡πÄ‡∏Ç‡πâ‡∏≤‡∏°‡∏≤
        document.getElementById("sidebar-container").innerHTML = html;
      })
      .then(() => {
        // ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏ï‡∏±‡∏ß Sidebar ‡∏ñ‡∏π‡∏Å‡πÇ‡∏´‡∏•‡∏î‡πÄ‡∏Ç‡πâ‡∏≤‡∏°‡∏≤‡πÉ‡∏ô DOM ‡πÅ‡∏•‡πâ‡∏ß
        // ‡πÉ‡∏´‡πâ Highlight ‡∏õ‡∏∏‡πà‡∏°‡∏™‡∏ñ‡∏¥‡∏ï‡∏¥
        const btnStats = document.getElementById("btnStatistic");
        btnStats.classList.add("btn-sidebar-active");
      })
      .catch((err) => console.error("Failed to load sidebar:", err));
    // end of fetch sidebar
    // Bar Chart Data
    fetch('http://localhost:3000/mostroomalldata')
      .then(response => {
        if (!response.ok) {
          throw new Error(`HTTP error! status: ${response.status}`);
        }
        return response.json();
      })
      .then(data => {
        console.log("Fetched Data:", data); // üõ† Debug: ‡∏î‡∏π‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• API

        const barCtx = document.getElementById('barChart').getContext('2d');
        if (!barCtx) {
          console.error("Canvas element not found!");
          return;
        }

        // Prepare data for the Chart.js chart after fetching
        const labels = data.map(item => `SC2-${item.room_id}`);
        const totalCount = data.map(item => item.total_count);
        const csCount = data.map(item => item.cs_count);
        const itCount = data.map(item => item.it_count);

        new Chart(barCtx, {
          type: 'bar',
          data: {
            labels: labels,
            datasets: [
              {
                label: '‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ô‡∏¥‡∏™‡∏¥‡∏ï‡∏£‡∏ß‡∏°',
                data: totalCount,
                backgroundColor: '#E5D2BA'
              },
              {
                label: '‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ô‡∏¥‡∏™‡∏¥‡∏ï ‡∏™‡∏≤‡∏Ç‡∏≤ ‡∏ß‡∏¥‡∏ó‡∏¢‡∏≤‡∏Å‡∏≤‡∏£‡∏Ñ‡∏≠‡∏°‡∏Ø',
                data: csCount,
                backgroundColor: '#E54715'
              },
              {
                label: '‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ô‡∏¥‡∏™‡∏¥‡∏ï ‡∏™‡∏≤‡∏Ç‡∏≤‡πÄ‡∏ó‡∏Ñ‡πÇ‡∏ô‡πÇ‡∏•‡∏¢‡∏µ‡∏Ø',
                data: itCount,
                backgroundColor: '#622BBE',
                padding: {
                  top: 10,
                  bottom: 30
                }
              }
            ]
          },
          options: {
            responsive: true,
            plugins: {
              legend: {
                position: 'bottom', // Position legend at the bottom
                labels: {
                  font: {
                    size: 16 // üî• ‡∏õ‡∏£‡∏±‡∏ö‡∏Ç‡∏ô‡∏≤‡∏î‡∏ü‡∏≠‡∏ô‡∏ï‡πå‡∏Ç‡∏≠‡∏á legend
                  }
                }
              },
              title: {
                display: true,
                text: '‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ô‡∏¥‡∏™‡∏¥‡∏ï',
                font: {
                  size: 14 // üî• ‡∏õ‡∏£‡∏±‡∏ö‡∏Ç‡∏ô‡∏≤‡∏î‡∏ü‡∏≠‡∏ô‡∏ï‡πå‡∏Ç‡∏≠‡∏á title
                }
              }
            },
            scales: {
              x: {
                ticks: {
                  font: {
                    size: 16 // üî• ‡∏õ‡∏£‡∏±‡∏ö‡∏Ç‡∏ô‡∏≤‡∏î‡∏ü‡∏≠‡∏ô‡∏ï‡πå‡∏Ç‡∏≠‡∏á labels ‡∏ö‡∏ô‡πÅ‡∏Å‡∏ô X
                  }
                }
              },
              y: {
                beginAtZero: true,
                ticks: {
                  callback: function (value) {
                    return Math.floor(value); // üî• ‡∏õ‡∏±‡∏î‡∏Ñ‡πà‡∏≤‡∏ó‡∏®‡∏ô‡∏¥‡∏¢‡∏°‡∏≠‡∏≠‡∏Å
                  },
                  font: {
                    size: 14 // üî• ‡∏õ‡∏£‡∏±‡∏ö‡∏Ç‡∏ô‡∏≤‡∏î‡∏ü‡∏≠‡∏ô‡∏ï‡πå‡∏Ç‡∏≠‡∏á labels ‡∏ö‡∏ô‡πÅ‡∏Å‡∏ô Y
                  }
                }
              }
            }
          }
        });
      })
      .catch(error => {
        console.error('Error fetching data:', error);
      });
    // Doughnut Chart 1 Data
    fetch('http://localhost:3000/brokendEquipment')
      .then(response => {
        if (!response.ok) {
          throw new Error(`HTTP error! status: ${response.status}`);
        }
        return response.json();
      })
      .then(data => {
        console.log("Fetched Data:", data); // üõ† Debug: ‡∏î‡∏π‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• API

        const doughnutCtx1 = document.getElementById('doughnutChart1');


        if (!doughnutCtx1) {
          console.error("Canvas element donut not found!");
          return;
        }

        new Chart(doughnutCtx1.getContext('2d'), {  // ‚úÖ ‡πÉ‡∏ä‡πâ .getContext('2d') ‡∏ï‡∏£‡∏á‡∏ô‡∏µ‡πâ
          type: 'doughnut',
          data: {
            labels: data.map(item => item.Equipments_name), // ‚úÖ ‡πÉ‡∏ä‡πâ‡∏Ñ‡∏µ‡∏¢‡πå‡∏ó‡∏µ‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á
            datasets: [{
              data: data.map(item => item.count),
              backgroundColor: ['#E5D2BA', '#E54715', '#622BBE'], // ‚úÖ ‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡∏™‡∏µ
            }]
          },
          options: {
            responsive: true,
            plugins: {
              legend: { position: 'bottom' },
              title: { display: true, text: '‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå‡∏ó‡∏µ‡πà‡πÄ‡∏™‡∏µ‡∏¢' }
            }
          }
        });
      })
      .catch(error => {
        console.error("‚ùå Error fetching data:", error);
      });





    // Doughnut Chart 2 Data
    fetch('http://localhost:3000/borrowEquipment')
      .then(response => {
        if (!response.ok) {
          throw new Error(`HTTP error! status: ${response.status}`);
        }
        return response.json();
      })
      .then(data => {
        console.log("Fetched Data:", data); // üõ† Debug: ‡∏î‡∏π‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• API

        const doughnutCtx2 = document.getElementById('doughnutChart2');


        if (!doughnutCtx2) {
          console.error("Canvas element donut not found!");
          return;
        }

        new Chart(doughnutCtx2.getContext('2d'), {  // ‚úÖ ‡πÉ‡∏ä‡πâ .getContext('2d') ‡∏ï‡∏£‡∏á‡∏ô‡∏µ‡πâ
          type: 'doughnut',
          data: {
            labels: data.map(item => item.name), // ‚úÖ ‡πÉ‡∏ä‡πâ‡∏Ñ‡∏µ‡∏¢‡πå‡∏ó‡∏µ‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á
            datasets: [{
              data: data.map(item => item.total),
              backgroundColor: ['#E5D2BA', '#E54715', '#622BBE'], // ‚úÖ ‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡∏™‡∏µ
            }]
          },
          options: {
            responsive: true,
            plugins: {
              legend: { position: 'bottom' },
              title: { display: true, text: '‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå‡∏ó‡∏µ‡πà‡∏¢‡∏∑‡∏°' }
            }
          }
        });
      })
      .catch(error => {
        console.error("‚ùå Error fetching data:", error);
      });


    // ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡πÅ‡∏™‡∏î‡∏á‡πÉ‡∏ô‡∏Å‡∏£‡∏≤‡∏ü
    fetch('http://localhost:3000/daysroom')
      .then(response => {
        if (!response.ok) {
          throw new Error(`HTTP error! status: ${response.status}`);
        }
        return response.json();
      })
      .then(data => {
        console.log("Fetched Data:", data); // üõ† Debug: ‡∏î‡∏π‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• API

        const barCtx2 = document.getElementById('barChart2').getContext('2d');
        if (!barCtx2) {
          console.error("Canvas element not found!");
          return;
        }

        // Prepare data for the Chart.js chart after fetching
        const labels2 = data.map(item => item.day_of_week);
        const csCount2 = data.map(item => item.cs_count);
        const itCount2 = data.map(item => item.it_count);

        new Chart(barCtx2, {
          type: 'bar',
          data: {
            labels: labels2,
            datasets: [
              {
                label: '‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ô‡∏¥‡∏™‡∏¥‡∏ï ‡∏™‡∏≤‡∏Ç‡∏≤ ‡∏ß‡∏¥‡∏ó‡∏¢‡∏≤‡∏Å‡∏≤‡∏£‡∏Ñ‡∏≠‡∏°‡∏Ø',
                data: csCount2,
                backgroundColor: '#E54715'
              },
              {
                label: '‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ô‡∏¥‡∏™‡∏¥‡∏ï ‡∏™‡∏≤‡∏Ç‡∏≤‡πÄ‡∏ó‡∏Ñ‡πÇ‡∏ô‡πÇ‡∏•‡∏¢‡∏µ‡∏Ø',
                data: itCount2,
                backgroundColor: '#622BBE'
              }
            ]
          },
          options: {
            responsive: true,
            plugins: {
              legend: {
                position: 'bottom', // Position legend at the bottom
                labels: {
                  font: {
                    size: 20 // üî• ‡∏õ‡∏£‡∏±‡∏ö‡∏Ç‡∏ô‡∏≤‡∏î‡∏ü‡∏≠‡∏ô‡∏ï‡πå‡∏Ç‡∏≠‡∏á legend
                  }
                }
              },
              title: {
                display: true,
                text: '‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ô‡∏¥‡∏™‡∏¥‡∏ï',
                font: {
                  size: 16 // üî• ‡∏õ‡∏£‡∏±‡∏ö‡∏Ç‡∏ô‡∏≤‡∏î‡∏ü‡∏≠‡∏ô‡∏ï‡πå‡∏Ç‡∏≠‡∏á title
                }
              }
            },
            scales: {
              x: {
                ticks: {
                  font: {
                    size: 16 // üî• ‡∏õ‡∏£‡∏±‡∏ö‡∏Ç‡∏ô‡∏≤‡∏î‡∏ü‡∏≠‡∏ô‡∏ï‡πå‡∏Ç‡∏≠‡∏á labels ‡∏ö‡∏ô‡πÅ‡∏Å‡∏ô X
                  }
                }
              },
              y: {
                beginAtZero: true,
                ticks: {
                  callback: function (value) {
                    return Math.floor(value); // üî• ‡∏õ‡∏±‡∏î‡∏Ñ‡πà‡∏≤‡∏ó‡∏®‡∏ô‡∏¥‡∏¢‡∏°‡∏≠‡∏≠‡∏Å
                  },
                  font: {
                    size: 16 // üî• ‡∏õ‡∏£‡∏±‡∏ö‡∏Ç‡∏ô‡∏≤‡∏î‡∏ü‡∏≠‡∏ô‡∏ï‡πå‡∏Ç‡∏≠‡∏á labels ‡∏ö‡∏ô‡πÅ‡∏Å‡∏ô Y
                  }
                }
              }
            }
          }
        });
      })
      .catch(error => {
        console.error('Error fetching data:', error);
      });

    // ‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏≤‡∏Å API
    fetch("http://localhost:3000/useralldata")
      .then(response => response.json()) // ‡πÅ‡∏õ‡∏•‡∏á‡πÄ‡∏õ‡πá‡∏ô JSON
      .then(data => {
        const userList = document.getElementById("userList");
        userList.innerHTML = "";  // ‡∏•‡πâ‡∏≤‡∏á‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏î‡∏¥‡∏°

        data.forEach(user => {
          const div = document.createElement("div");
          div.className = "split-container";
          div.innerHTML = `<p>${user.name}</p> <p>${user.stat} ‡∏Ñ‡∏£‡∏±‡πâ‡∏á</p>`;
          userList.appendChild(div);
        });
      })
      .catch(error => {
        console.error("‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î:", error);
        document.getElementById("userList").innerHTML = "‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏î‡πâ";
      });

  </script>
</body>

</html>